var internals = {};

exports = module.exports = internals.Reporter = function (options) {

    this.settings = options;
};

internals.Reporter.convert = function (results) {

    var totalDuration = results.duration;
    var testsOutput= '';
    //console.log(results.tests);
    var totalTests = 0;
    var totalFailures = 0;
    Object.keys(results.tests).forEach(function(experiments) {

        //console.log(results.tests[experiments]);
        //console.log(experiments);
        var subTests = 0;
        var failures = 0;
        var passes = 0;
        var subtestsOutput = '';
        for (var i = 0; i < results.tests[experiments].length; i++) {

            totalTests++;
            subTests++;
            var title = results.tests[experiments][i].title.replace(/"/g, '') + ' (' + totalTests + ')';
            //console.log(title);
            var duration = results.tests[experiments][i].duration;
            var durationJenkins = duration / 1000;
            var err = results.tests[experiments][i].err;
            if (err) {
                failures++;
                totalFailures++;
                var details = err.toString().replace(/"/g, '').replace(/</g,'&lt;').replace(/>/g, '&gt;').replace(/&/g, '%26');
                var short_err = details.split('\n\n\t')[0];
//                var detailsObj = {};
//                if (details) {
//                    detailsObj=JSON.parse(details);
//                }
                subtestsOutput += '        <testcase class="' + experiments + '" name="'+title+'" time="'+durationJenkins+'">\n';
                subtestsOutput += '            <error message="' + short_err + '">\n';
                subtestsOutput += details +'\n';
                subtestsOutput += '            </error>\n';
                subtestsOutput += '        </testcase>\n';
            }
            else
            {

                passes++;
                subtestsOutput += '        <testcase class="' + experiments + '" name="'+title+'" time="'+durationJenkins+'"/>\n';
            }
        }
        testsOutput += '\n    <testsuite name="'+experiments+'" tests="'+subTests+'" errors="0" failures="'+failures+'" skip="0">\n';
        testsOutput += subtestsOutput;
        testsOutput += '    </testsuite>';
        subTests = 0;
        failures = 0;
        passes = 0;
    });
    console.log('<?xml version="1.0" encoding="UTF-8"?>');
    console.log('<testsuites name="tests" tests="'+totalTests+'" errors="0" failures="'+totalFailures+'">');
    console.log(testsOutput);
    console.log('</testsuites>');
};
